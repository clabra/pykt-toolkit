{
  "experiment_name": "phase3semantic_global_retention_seed21",
  "best_val_auc": 0.7240382782743481,
  "final_consistency_metrics": {
    "monotonicity_violation_rate": 0.0,
    "negative_gain_rate": 0.0,
    "bounds_violation_rate": 0.0,
    "mastery_correlation": -0.026858597028307257,
    "gain_correlation": 0.048873049510725707
  },
  "train_history": {
    "train_loss": [
      0.5378603700529109,
      0.509191166860452,
      0.4933920040958286,
      0.4754899454549187,
      0.45124470539043604,
      0.4478455474648451,
      0.41526238983159236,
      0.3943557005780966,
      0.38748740007222626,
      0.34282252053522694,
      0.33068918602763064,
      0.31141888879123747
    ],
    "train_auc": [
      0.691630633681805,
      0.7236905825182437,
      0.7357289152643728,
      0.7471921272126356,
      0.760446454258328,
      0.7790301372167063,
      0.8006615467698934,
      0.8267195883173636,
      0.8543765230073097,
      0.885779330264176,
      0.9069056454588249,
      0.9212721536380757
    ],
    "val_auc": [
      0.7160201092828534,
      0.7230765894302313,
      0.7240382782743481,
      0.7208099928004956,
      0.7140076339643863,
      0.7033437459672398,
      0.687822035043283,
      0.6707303034764709,
      0.6544064412222905,
      0.6584198838145365,
      0.6510043405054933,
      0.6463027169394255
    ],
    "consistency_metrics": [
      {
        "monotonicity_violation_rate": 0.0,
        "negative_gain_rate": 0.0,
        "bounds_violation_rate": 0.0,
        "mastery_correlation": -0.001754120890172712,
        "gain_correlation": 0.10458477648628162
      },
      {
        "monotonicity_violation_rate": 0.0,
        "negative_gain_rate": 0.0,
        "bounds_violation_rate": 0.0,
        "mastery_correlation": -0.013585437851762847,
        "gain_correlation": 0.07332071355165304
      },
      {
        "monotonicity_violation_rate": 0.0,
        "negative_gain_rate": 0.0,
        "bounds_violation_rate": 0.0,
        "mastery_correlation": -0.0204561122791427,
        "gain_correlation": 0.05161849419413503
      },
      {
        "monotonicity_violation_rate": 0.0,
        "negative_gain_rate": 0.0,
        "bounds_violation_rate": 0.0,
        "mastery_correlation": -0.011218958096423067,
        "gain_correlation": 0.04356802140315596
      },
      {
        "monotonicity_violation_rate": 0.0,
        "negative_gain_rate": 0.0,
        "bounds_violation_rate": 0.0,
        "mastery_correlation": 0.016704543107948937,
        "gain_correlation": 0.06920883297037533
      },
      {
        "monotonicity_violation_rate": 0.0,
        "negative_gain_rate": 0.0,
        "bounds_violation_rate": 0.0,
        "mastery_correlation": 0.002739248578654878,
        "gain_correlation": 0.047651603024439784
      },
      {
        "monotonicity_violation_rate": 0.0,
        "negative_gain_rate": 0.0,
        "bounds_violation_rate": 0.0,
        "mastery_correlation": 0.0177843608309162,
        "gain_correlation": 0.07090342961508946
      },
      {
        "monotonicity_violation_rate": 0.0,
        "negative_gain_rate": 0.0,
        "bounds_violation_rate": 0.0,
        "mastery_correlation": 0.020053356554863726,
        "gain_correlation": 0.06475959282078143
      },
      {
        "monotonicity_violation_rate": 0.0,
        "negative_gain_rate": 0.0,
        "bounds_violation_rate": 0.0,
        "mastery_correlation": 0.0010587750186773475,
        "gain_correlation": 0.058588364363027876
      },
      {
        "monotonicity_violation_rate": 0.0,
        "negative_gain_rate": 0.0,
        "bounds_violation_rate": 0.0,
        "mastery_correlation": -0.005444263888593621,
        "gain_correlation": 0.06471214034867315
      },
      {
        "monotonicity_violation_rate": 0.0,
        "negative_gain_rate": 0.0,
        "bounds_violation_rate": 0.0,
        "mastery_correlation": 0.01430080693526522,
        "gain_correlation": 0.05725274538656006
      },
      {
        "monotonicity_violation_rate": 0.0,
        "negative_gain_rate": 0.0,
        "bounds_violation_rate": 0.0,
        "mastery_correlation": 0.006313800720485243,
        "gain_correlation": 0.06430451198565879
      }
    ],
    "semantic_trajectory": [
      {
        "epoch": 1,
        "mastery_correlation": -0.001754120890172712,
        "gain_correlation": 0.10458477648628162,
        "warmup_scale": 0.125,
        "alignment_corr_mastery": 0.1655273735523224,
        "alignment_corr_gain": 0.22083397209644318,
        "global_alignment_mastery_corr": 0.010894623447578244,
        "global_alignment_gain_corr": 0.00827519654451559,
        "effective_alignment_weight": 0.03125,
        "peak_mastery_corr": 0.010894623447578244,
        "retention_loss_value": 0.0,
        "mean_lag_corr": 0.0,
        "lag_corr_count": 0,
        "consistency_loss_weight_current": 0.3,
        "sparsity_loss_weight_current": 0.2,
        "loss_shares": {
          "main": 0.9896266466166127,
          "constraint_total": 0.010373355664994966,
          "alignment": -0.013723036957280324,
          "lag": 0.0,
          "retention": 0.0
        },
        "mean_mastery_variance": 0.018711782856771983,
        "min_mastery_variance": 0.01308447401970625,
        "max_mastery_variance": 0.04246590659022331,
        "per_lag_correlations": []
      },
      {
        "epoch": 2,
        "mastery_correlation": -0.013585437851762847,
        "gain_correlation": 0.07332071355165304,
        "warmup_scale": 0.25,
        "alignment_corr_mastery": 0.17300362884998322,
        "alignment_corr_gain": 0.25555431842803955,
        "global_alignment_mastery_corr": 0.008632259840378537,
        "global_alignment_gain_corr": 0.009840803036883396,
        "effective_alignment_weight": 0.0625,
        "peak_mastery_corr": 0.010894623447578244,
        "retention_loss_value": 0.0,
        "mean_lag_corr": 0.0,
        "lag_corr_count": 0,
        "consistency_loss_weight_current": 0.3,
        "sparsity_loss_weight_current": 0.2,
        "loss_shares": {
          "main": 1.0104538175694546,
          "constraint_total": -0.01045381752207048,
          "alignment": -0.044350310218552555,
          "lag": 0.0,
          "retention": 0.0
        },
        "mean_mastery_variance": 0.01569184424944338,
        "min_mastery_variance": 0.011918983422219753,
        "max_mastery_variance": 0.020649904385209084,
        "per_lag_correlations": []
      },
      {
        "epoch": 3,
        "mastery_correlation": -0.0204561122791427,
        "gain_correlation": 0.05161849419413503,
        "warmup_scale": 0.375,
        "alignment_corr_mastery": 0.1433652639389038,
        "alignment_corr_gain": 0.2948688566684723,
        "global_alignment_mastery_corr": -0.018356524995518462,
        "global_alignment_gain_corr": 0.03989226047075742,
        "effective_alignment_weight": 0.09375,
        "peak_mastery_corr": 0.010894623447578244,
        "retention_loss_value": 0.0,
        "mean_lag_corr": 0.0,
        "lag_corr_count": 0,
        "consistency_loss_weight_current": 0.3,
        "sparsity_loss_weight_current": 0.2,
        "loss_shares": {
          "main": 1.0270784501613948,
          "constraint_total": -0.02707845053304491,
          "alignment": -0.0778173660272282,
          "lag": 0.0,
          "retention": 0.0
        },
        "mean_mastery_variance": 0.016168335163145486,
        "min_mastery_variance": 0.012486129999160767,
        "max_mastery_variance": 0.02131432667374611,
        "per_lag_correlations": []
      },
      {
        "epoch": 4,
        "mastery_correlation": -0.011218958096423067,
        "gain_correlation": 0.04356802140315596,
        "warmup_scale": 0.5,
        "alignment_corr_mastery": 0.17047598958015442,
        "alignment_corr_gain": 0.3261840343475342,
        "global_alignment_mastery_corr": -0.0011890028965232584,
        "global_alignment_gain_corr": 0.04902391219419769,
        "effective_alignment_weight": 0.125,
        "peak_mastery_corr": 0.010894623447578244,
        "retention_loss_value": 0.0,
        "mean_lag_corr": 0.0,
        "lag_corr_count": 0,
        "consistency_loss_weight_current": 0.3,
        "sparsity_loss_weight_current": 0.2,
        "loss_shares": {
          "main": 1.049551272312082,
          "constraint_total": -0.04955126869921912,
          "alignment": -0.11890003059235905,
          "lag": 0.0,
          "retention": 0.0
        },
        "mean_mastery_variance": 0.016032332723352267,
        "min_mastery_variance": 0.012330417521297932,
        "max_mastery_variance": 0.020608441904187202,
        "per_lag_correlations": []
      },
      {
        "epoch": 5,
        "mastery_correlation": 0.016704543107948937,
        "gain_correlation": 0.06920883297037533,
        "warmup_scale": 0.625,
        "alignment_corr_mastery": 0.20028147101402283,
        "alignment_corr_gain": 0.3682926893234253,
        "global_alignment_mastery_corr": -0.003356077889232741,
        "global_alignment_gain_corr": 0.0352626381519561,
        "effective_alignment_weight": 0.15625,
        "peak_mastery_corr": 0.010894623447578244,
        "retention_loss_value": 0.0,
        "mean_lag_corr": 0.0,
        "lag_corr_count": 0,
        "consistency_loss_weight_current": 0.3,
        "sparsity_loss_weight_current": 0.2,
        "loss_shares": {
          "main": 1.0849432656396187,
          "constraint_total": -0.08494326914717425,
          "alignment": -0.17523949660483998,
          "lag": 0.0,
          "retention": 0.0
        },
        "mean_mastery_variance": 0.017188247939851617,
        "min_mastery_variance": 0.012306955642998219,
        "max_mastery_variance": 0.02319047786295414,
        "per_lag_correlations": []
      },
      {
        "epoch": 6,
        "mastery_correlation": 0.002739248578654878,
        "gain_correlation": 0.047651603024439784,
        "warmup_scale": 0.75,
        "alignment_corr_mastery": 0.19655708968639374,
        "alignment_corr_gain": 0.38943010568618774,
        "global_alignment_mastery_corr": 0.01038165738573298,
        "global_alignment_gain_corr": 0.06081602979122787,
        "effective_alignment_weight": 0.13124999999999998,
        "peak_mastery_corr": 0.010894623447578244,
        "retention_loss_value": 0.0,
        "mean_lag_corr": 0.0,
        "lag_corr_count": 0,
        "consistency_loss_weight_current": 0.3,
        "sparsity_loss_weight_current": 0.2,
        "loss_shares": {
          "main": 1.0612448745468965,
          "constraint_total": -0.06124487515029277,
          "alignment": -0.16880541329942708,
          "lag": 0.0,
          "retention": 0.0
        },
        "mean_mastery_variance": 0.01591537622590139,
        "min_mastery_variance": 0.0116423349827528,
        "max_mastery_variance": 0.021532606333494186,
        "per_lag_correlations": []
      },
      {
        "epoch": 7,
        "mastery_correlation": 0.0177843608309162,
        "gain_correlation": 0.07090342961508946,
        "warmup_scale": 0.875,
        "alignment_corr_mastery": 0.21296480298042297,
        "alignment_corr_gain": 0.4477836489677429,
        "global_alignment_mastery_corr": 0.0077590665634488685,
        "global_alignment_gain_corr": 0.04807143819256453,
        "effective_alignment_weight": 0.15312499999999998,
        "peak_mastery_corr": 0.010894623447578244,
        "retention_loss_value": 0.0,
        "mean_lag_corr": 0.0,
        "lag_corr_count": 0,
        "consistency_loss_weight_current": 0.3,
        "sparsity_loss_weight_current": 0.2,
        "loss_shares": {
          "main": 1.1002548481078773,
          "constraint_total": -0.10025484843324793,
          "alignment": -0.234780680826992,
          "lag": 0.0,
          "retention": 0.0
        },
        "mean_mastery_variance": 0.015339269095288656,
        "min_mastery_variance": 0.011298399418592453,
        "max_mastery_variance": 0.019605636596679688,
        "per_lag_correlations": []
      },
      {
        "epoch": 8,
        "mastery_correlation": 0.020053356554863726,
        "gain_correlation": 0.06475959282078143,
        "warmup_scale": 1.0,
        "alignment_corr_mastery": 0.2309168428182602,
        "alignment_corr_gain": 0.5087064504623413,
        "global_alignment_mastery_corr": 0.008977179157542802,
        "global_alignment_gain_corr": 0.05403359782804425,
        "effective_alignment_weight": 0.14319805728550997,
        "peak_mastery_corr": 0.010894623447578244,
        "retention_loss_value": 0.0,
        "mean_lag_corr": 0.0,
        "lag_corr_count": 0,
        "consistency_loss_weight_current": 0.2,
        "sparsity_loss_weight_current": 0.2,
        "loss_shares": {
          "main": 1.0953520479326482,
          "constraint_total": -0.0953520490583996,
          "alignment": -0.25622682205702624,
          "lag": 0.0,
          "retention": 0.0
        },
        "mean_mastery_variance": 0.014939724023748248,
        "min_mastery_variance": 0.011837855912744999,
        "max_mastery_variance": 0.018800435587763786,
        "per_lag_correlations": []
      },
      {
        "epoch": 9,
        "mastery_correlation": 0.0010587750186773475,
        "gain_correlation": 0.058588364363027876,
        "warmup_scale": 1.0,
        "alignment_corr_mastery": 0.23162198066711426,
        "alignment_corr_gain": 0.5831286311149597,
        "global_alignment_mastery_corr": 0.017214131583459677,
        "global_alignment_gain_corr": 0.04063566676729048,
        "effective_alignment_weight": 0.09982082746047524,
        "peak_mastery_corr": 0.017214131583459677,
        "retention_loss_value": 0.0,
        "mean_lag_corr": 0.0,
        "lag_corr_count": 0,
        "consistency_loss_weight_current": 0.2,
        "sparsity_loss_weight_current": 0.2,
        "loss_shares": {
          "main": 1.0358093898455136,
          "constraint_total": -0.03580939089159272,
          "alignment": -0.19881957727385177,
          "lag": 0.0,
          "retention": 0.0
        },
        "mean_mastery_variance": 0.013399990806307818,
        "min_mastery_variance": 0.011147434823215008,
        "max_mastery_variance": 0.01586206629872322,
        "per_lag_correlations": []
      },
      {
        "epoch": 10,
        "mastery_correlation": -0.005444263888593621,
        "gain_correlation": 0.06471214034867315,
        "warmup_scale": 1.0,
        "alignment_corr_mastery": 0.23388342559337616,
        "alignment_corr_gain": 0.613517701625824,
        "global_alignment_mastery_corr": 0.011573613784591241,
        "global_alignment_gain_corr": 0.04410777581186267,
        "effective_alignment_weight": 0.09699555256180463,
        "peak_mastery_corr": 0.017214131583459677,
        "retention_loss_value": 8.967249184158104e-05,
        "mean_lag_corr": 0.0,
        "lag_corr_count": 0,
        "consistency_loss_weight_current": 0.2,
        "sparsity_loss_weight_current": 0.2,
        "loss_shares": {
          "main": 1.051723350477655,
          "constraint_total": -0.051723351828933124,
          "alignment": -0.2358135873937429,
          "lag": 0.0,
          "retention": 0.0
        },
        "mean_mastery_variance": 0.012961196269203036,
        "min_mastery_variance": 0.011493687517940998,
        "max_mastery_variance": 0.014911980368196964,
        "per_lag_correlations": []
      },
      {
        "epoch": 11,
        "mastery_correlation": 0.01430080693526522,
        "gain_correlation": 0.05725274538656006,
        "warmup_scale": 1.0,
        "alignment_corr_mastery": 0.2295588105916977,
        "alignment_corr_gain": 0.644784688949585,
        "global_alignment_mastery_corr": -0.00534339063645651,
        "global_alignment_gain_corr": 0.021760005585577648,
        "effective_alignment_weight": 0.06925117536952717,
        "peak_mastery_corr": 0.017214131583459677,
        "retention_loss_value": 0.002458053110788266,
        "mean_lag_corr": 0.0,
        "lag_corr_count": 0,
        "consistency_loss_weight_current": 0.2,
        "sparsity_loss_weight_current": 0.2,
        "loss_shares": {
          "main": 0.9928788653140697,
          "constraint_total": 0.007119695479620418,
          "alignment": -0.1832399103466587,
          "lag": 0.0,
          "retention": 1.40501818889339e-06
        },
        "mean_mastery_variance": 0.012670621980425607,
        "min_mastery_variance": 0.011334582231938839,
        "max_mastery_variance": 0.01430467702448368,
        "per_lag_correlations": []
      },
      {
        "epoch": 12,
        "mastery_correlation": 0.006313800720485243,
        "gain_correlation": 0.06430451198565879,
        "warmup_scale": 1.0,
        "alignment_corr_mastery": 0.24108244478702545,
        "alignment_corr_gain": 0.651835024356842,
        "global_alignment_mastery_corr": 0.034809148613033664,
        "global_alignment_gain_corr": 0.029077434557014687,
        "effective_alignment_weight": 0.0610686781257391,
        "peak_mastery_corr": 0.034809148613033664,
        "retention_loss_value": 0.0,
        "mean_lag_corr": 0.0,
        "lag_corr_count": 0,
        "consistency_loss_weight_current": 0.2,
        "sparsity_loss_weight_current": 0.2,
        "loss_shares": {
          "main": 0.9740225324601622,
          "constraint_total": 0.025936598141680395,
          "alignment": -0.17569673903443556,
          "lag": 0.0,
          "retention": 4.0896768791687046e-05
        },
        "mean_mastery_variance": 0.012282898437251081,
        "min_mastery_variance": 0.011406488716602325,
        "max_mastery_variance": 0.013705897144973278,
        "per_lag_correlations": []
      }
    ]
  },
  "model_config": {
    "num_c": 100,
    "seq_len": 200,
    "d_model": 512,
    "n_heads": 8,
    "num_encoder_blocks": 6,
    "d_ff": 1024,
    "dropout": 0.2,
    "emb_type": "qid",
    "monitor_frequency": 50,
    "use_mastery_head": true,
    "use_gain_head": true,
    "non_negative_loss_weight": 0.0,
    "monotonicity_loss_weight": 0.1,
    "mastery_performance_loss_weight": 0.8,
    "gain_performance_loss_weight": 0.8,
    "sparsity_loss_weight": 0.2,
    "consistency_loss_weight": 0.3
  },
  "training_args": {
    "dataset_name": "assist2015",
    "num_epochs": 12,
    "batch_size": 64,
    "learning_rate": 0.000174,
    "weight_decay": 1.7571e-05,
    "enhanced_constraints": true,
    "fold": 0,
    "constraint_weights": {
      "non_negative_loss_weight": 0.0,
      "monotonicity_loss_weight": 0.1,
      "mastery_performance_loss_weight": 0.8,
      "gain_performance_loss_weight": 0.8,
      "sparsity_loss_weight": 0.2,
      "consistency_loss_weight": 0.3
    },
    "alignment": {
      "enable_alignment_loss": true,
      "alignment_weight": 0.25,
      "alignment_warmup_epochs": 8,
      "adaptive_alignment": true,
      "alignment_min_correlation": 0.05
    },
    "global_alignment": {
      "enable_global_alignment_pass": true,
      "alignment_global_students": 600,
      "use_residual_alignment": false,
      "alignment_residual_window": 5
    },
    "refinement": {
      "enable_retention_loss": true,
      "retention_delta": 0.005,
      "retention_weight": 0.14,
      "enable_lag_gain_loss": false,
      "lag_gain_weight": 0.06,
      "lag_max_lag": 3,
      "lag_l1_weight": 0.5,
      "lag_l2_weight": 0.3,
      "lag_l3_weight": 0.2,
      "enable_cosine_perf_schedule": false,
      "consistency_rebalance_epoch": 8,
      "consistency_rebalance_threshold": 0.1,
      "consistency_rebalance_new_weight": 0.2,
      "variance_floor": 0.0001,
      "variance_floor_patience": 3,
      "variance_floor_reduce_factor": 0.5,
      "alignment_share_cap": 0.08,
      "alignment_share_decay_factor": 0.7
    }
  },
  "timestamp": "2025-10-22T08:32:49.520910"
}